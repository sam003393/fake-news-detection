<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fake News Detector</title>
<style>
/* ===== Global Styles ===== */
* { margin:0; padding:0; box-sizing:border-box; }
body {
    font-family:'Segoe UI', Tahoma, Verdana, sans-serif;
    min-height:100vh;
    display:flex;
    justify-content:center;
    align-items:flex-start;
    padding:20px;
    transition: background 1s ease-in-out;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    position: relative;
}

/* Overlay for readability */
body::before {
    content: "";
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    background-color: rgba(0,0,0,0.4);
    backdrop-filter: blur(2px);
    z-index: 0;
}

.container {
    position: relative;
    z-index: 1;
    background: rgba(255, 255, 255, 0.85);
    border-radius: 20px;
    padding: 40px;
    max-width: 700px;
    width: 100%;
    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    transition: background 0.5s, color 0.5s;
}

/* Dark Mode */
body.dark .container {
    background: rgba(31,31,46,0.85);
    color: #f1f1f1;
}
body.dark h1, body.dark label, body.dark .subtitle { color:#f1f1f1; }

h1 { text-align:center; color:#333; margin-bottom:10px; font-size:2.5em; }
.subtitle { text-align:center; color:#666; margin-bottom:30px; font-size:1.1em; }

.form-group { margin-bottom:20px; }
label { display:block; margin-bottom:8px; color:#333; font-weight:600; font-size:1.1em; }
textarea { width:100%; padding:15px; border:2px solid #ddd; border-radius:10px; font-size:16px; font-family:inherit; resize:vertical; min-height:120px; transition:border-color 0.3s, background 0.5s, color 0.5s; }
textarea:focus { outline:none; border-color:#667eea; }
body.dark textarea { background:#2b2b3d; color:white; border-color:#444; }

.file-input-wrapper { position:relative; overflow:hidden; display:inline-block; width:100%; }
.file-input-wrapper input[type=file] { position:absolute; left:-9999px; }
.file-input-label {
    display:flex; align-items:center; justify-content:center; padding:20px;
    border:2px dashed #ddd; border-radius:10px; cursor:pointer; transition:all 0.3s; background:#f8f9fa; font-weight:500;
}
.file-input-label:hover { border-color:#667eea; background:#f0f2ff; }
body.dark .file-input-label { background:#2b2b3d; border-color:#555; color:#f1f1f1; }

.file-name { margin-top:10px; color:#666; font-size:14px; text-align:center; }
.image-preview { margin-top:15px; text-align:center; }
.image-preview img { max-width:100%; max-height:250px; border-radius:10px; box-shadow:0 4px 12px rgba(0,0,0,0.1); }

button { width:100%; padding:16px; background: linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:white; border:none; border-radius:10px; font-size:18px; font-weight:600; cursor:pointer; transition: transform 0.2s, box-shadow 0.2s; margin-top:10px; }
button:hover { transform:translateY(-2px); box-shadow:0 6px 20px rgba(102,126,234,0.4); }
button:active { transform:translateY(0); }
button:disabled { background:#ccc; cursor:not-allowed; transform:none; }

.spinner-overlay {
    display:none;
    position:absolute;
    top:0; left:0; right:0; bottom:0;
    background: rgba(0,0,0,0.4);
    z-index:2;
    justify-content:center;
    align-items:center;
}
.spinner {
    border:4px solid #f3f3f3;
    border-top:4px solid #667eea;
    border-radius:50%;
    width:50px;
    height:50px;
    animation:spin 1s linear infinite;
}
@keyframes spin { 0%{ transform:rotate(0deg); } 100%{ transform:rotate(360deg); } }

.result-box { margin-top:25px; padding:25px; border-radius:15px; display:none; animation:slideIn 0.5s ease; transition:background 0.5s, border-color 0.5s, color 0.5s; }
@keyframes slideIn { from { opacity:0; transform:translateY(-20px); } to { opacity:1; transform:translateY(0); } }
.result-box.fake { background:#ffe5e5; border:2px solid #ff4444; }
.result-box.real { background:#e5ffe5; border:2px solid #44ff44; }
.result-box.error { background:#fff3cd; border:2px solid #ffc107; }
.result-title { font-size:1.5em; font-weight:bold; margin-bottom:15px; text-align:center; }
.result-box.fake .result-title { color:#d32f2f; }
.result-box.real .result-title { color:#388e3c; }
.result-box.error .result-title { color:#f57c00; }

.confidence-bar { background:#f0f0f0; border-radius:10px; height:30px; margin:15px 0; overflow:hidden; position:relative; }
.confidence-fill { height:100%; width:0%; display:flex; align-items:center; justify-content:center; color:white; font-weight:bold; transition: width 1.5s ease-in-out; }
.confidence-fill.fake { background: linear-gradient(90deg,#ff6b6b,#ee5a6f); }
.confidence-fill.real { background: linear-gradient(90deg,#51cf66,#37b24d); }

.probabilities { display:grid; grid-template-columns:1fr 1fr; gap:15px; margin-top:20px; }
.prob-card { padding:15px; border-radius:10px; text-align:center; transition: background 0.5s, border-color 0.5s; }
.prob-card.fake { background:#ffebee; border:1px solid #ffcdd2; }
.prob-card.real { background:#e8f5e9; border:1px solid #c8e6c9; }
.prob-label { font-size:0.9em; color:#666; margin-bottom:5px; }
.prob-value { font-size:1.8em; font-weight:bold; }
.prob-card.fake .prob-value { color:#d32f2f; }
.prob-card.real .prob-value { color:#388e3c; }

.error-message { color:#f57c00; text-align:center; font-weight:600; }

.live-news-container {
    margin-top: 40px;
    display:flex;
    flex-direction: column;
    gap:20px;
}

.live-news-card {
    display:flex;
    gap:15px;
    padding:15px;
    border-radius:10px;
    background: rgba(255,255,255,0.85);
    transition: background 0.5s, color 0.5s;
    align-items:center;
    box-shadow:0 4px 12px rgba(0,0,0,0.1);
}

body.dark .live-news-card {
    background: rgba(31,31,46,0.85);
    color:#f1f1f1;
}

.live-news-card img { width:80px; height:60px; object-fit:cover; border-radius:5px; }
.live-news-card .news-info { flex:1; }
.live-news-card .news-info h4 { font-size:1em; margin-bottom:5px; }
.live-news-card .news-info p { font-size:0.85em; color:#666; }
.live-news-card .prediction { font-weight:bold; }

@media (max-width:600px){ .container{padding:20px;} h1{font-size:2em;} .probabilities{grid-template-columns:1fr;} }
</style>
</head>
<body>

<div class="container">
    <button id="darkToggle" style="margin-bottom:15px;">üåô Dark Mode</button>
    <h1>üîç Fake News Detector</h1>
    <p class="subtitle">Upload an image or see live news predictions automatically</p>

    <!-- Manual Prediction Form -->
    <form id="newsForm">
        <div class="form-group">
            <label for="newsText">üìù News Text:</label>
            <textarea id="newsText" name="text" placeholder="Enter the news headline or article text here..." required></textarea>
        </div>

        <div class="form-group">
            <label for="newsImage">üì∑ Upload Image:</label>
            <div class="file-input-wrapper">
                <input type="file" id="newsImage" name="image" accept="image/*" required>
                <label for="newsImage" class="file-input-label"><span>üìÅ Click to upload image</span></label>
            </div>
            <div class="file-name" id="fileName"></div>
            <div class="image-preview" id="imagePreview"></div>
        </div>

        <button type="submit" id="submitBtn">Analyze News</button>
    </form>

    <div class="spinner-overlay" id="spinnerOverlay">
        <div class="spinner"></div>
    </div>

    <div class="result-box" id="resultBox">
        <div class="result-title" id="resultTitle"></div>
        <div class="confidence-bar">
            <div class="confidence-fill" id="confidenceFill"></div>
        </div>
        <div class="probabilities">
            <div class="prob-card fake">
                <div class="prob-label">Fake News Probability</div>
                <div class="prob-value" id="fakeProb">0%</div>
            </div>
            <div class="prob-card real">
                <div class="prob-label">Real News Probability</div>
                <div class="prob-value" id="realProb">0%</div>
            </div>
        </div>
    </div>

    <!-- Live News Section -->
    <div class="live-news-container" id="liveNewsContainer">
        <div style="text-align:center; padding:20px; color:#666;">Loading live news...</div>
    </div>
</div>

<script>
// ===== Dark Mode Toggle =====
const toggleBtn = document.getElementById("darkToggle");
if(localStorage.getItem("darkMode")==="enabled"){document.body.classList.add("dark"); toggleBtn.textContent="‚òÄÔ∏è Light Mode";}
toggleBtn.addEventListener("click", ()=>{
    document.body.classList.toggle("dark");
    if(document.body.classList.contains("dark")){localStorage.setItem("darkMode","enabled"); toggleBtn.textContent="‚òÄÔ∏è Light Mode";}
    else{localStorage.setItem("darkMode","disabled"); toggleBtn.textContent="üåô Dark Mode";}
});

// ===== Image Preview =====
const fileInput = document.getElementById("newsImage");
const fileName = document.getElementById("fileName");
const imagePreview = document.getElementById("imagePreview");
fileInput.addEventListener("change", function(e){
    const file = e.target.files[0];
    imagePreview.innerHTML=""; fileName.textContent="";
    if(file){
        fileName.textContent=`Selected: ${file.name}`;
        const reader = new FileReader();
        reader.onload = e => { imagePreview.innerHTML=`<img src="${e.target.result}" alt="Preview">`; };
        reader.readAsDataURL(file);
    }
});

// ===== Form Submission =====
const form = document.getElementById("newsForm");
const spinnerOverlay = document.getElementById("spinnerOverlay");
const resultBox = document.getElementById("resultBox");
const submitBtn = document.getElementById("submitBtn");

form.addEventListener("submit", async function(e){
    e.preventDefault();
    const formData = new FormData(form);

    submitBtn.disabled=true;
    submitBtn.textContent="Analyzing...";
    spinnerOverlay.style.display="flex";
    resultBox.style.display="none";

    try{
        const response = await fetch("/predict",{ method:"POST", body:formData });
        const result = await response.json();

        spinnerOverlay.style.display="none";
        submitBtn.disabled=false;
        submitBtn.textContent="Analyze News";

        if(result.status==="success"){ showResult(result); }
        else{ showError(result.message); }
    }catch{
        spinnerOverlay.style.display="none";
        submitBtn.disabled=false;
        submitBtn.textContent="Analyze News";
        showError("Server connection failed");
    }
});

// ===== Show Prediction Result =====
function showResult(result){
    const isFake = result.prediction==="Fake News";
    resultBox.className = "result-box "+(isFake?"fake":"real");
    resultBox.style.display="block";
    document.getElementById("resultTitle").textContent = isFake?"‚ö†Ô∏è Fake News Detected!":"‚úÖ Real News Detected!";

    const confidenceFill = document.getElementById("confidenceFill");
    confidenceFill.className = "confidence-fill "+(isFake?"fake":"real");
    confidenceFill.style.width = "0%";
    setTimeout(()=>{ confidenceFill.style.width = result.confidence+"%"; }, 200);
    confidenceFill.textContent = result.confidence+"% Confidence";

    document.getElementById("fakeProb").textContent = result.fake_probability+"%";
    document.getElementById("realProb").textContent = result.real_probability+"%";
}

// ===== Show Error =====
function showError(message){
    resultBox.className = "result-box error";
    resultBox.style.display="block";
    resultBox.innerHTML = `<div class="result-title">‚ö†Ô∏è Error</div><div class="error-message">${message}</div>`;
}

// ===== Auto-changing background every 20 seconds =====
const backgroundImages = [
    '/static/images/bg1.jpg',
    '/static/images/bg2.jpg',
    '/static/images/bg3.jpg',
    '/static/images/bg4.jpg',
    '/static/images/bg5.jpg',
    '/static/images/bg6.jpg',
    '/static/images/bg7.jpg'
];
let currentIndex = 0;
function changeBackground(){
    document.body.style.backgroundImage = `url(${backgroundImages[currentIndex]})`;
    currentIndex = (currentIndex + 1) % backgroundImages.length;
}
changeBackground();
setInterval(changeBackground, 20000);

// ===== Live News Auto Fetch + Predict with Entity Fact-Check =====
const liveNewsContainer = document.getElementById("liveNewsContainer");

async function fetchLiveNews(){
    try{
        const res = await fetch("/live-news");
        const data = await res.json();

        if(data.status !== "success") return;

        liveNewsContainer.innerHTML = "";

        for (const article of data.articles) {

            // Create card
            const card = document.createElement("div");
            card.className = "live-news-card";
            card.innerHTML = `
                <img src="${article.image}" alt="News">
                <div class="news-info">
                    <h4>${article.title}</h4>
                    <p>${article.description || ""}</p>
                </div>
                <div class="prediction">Analyzing...</div>
            `;
            liveNewsContainer.appendChild(card);

            const predDiv = card.querySelector(".prediction");

            // Prepare form data
            const formData = new FormData();
            formData.append("text", article.title || article.description || "No text");

            // Try image fetch, fallback to text-only
            try{
                if(article.image && article.image.startsWith("http")){
                    const imgResp = await fetch(article.image, { mode: "cors" });
                    const blob = await imgResp.blob();
                    formData.append("image", blob, "news.jpg");
                }
            }catch{
                console.warn("Image fetch blocked, using text only");
            }

            // Call predict API
            try{
                const predictRes = await fetch("/predict", {
                    method: "POST",
                    body: formData
                });
                const result = await predictRes.json();

                if(result.status === "success"){
                    predDiv.textContent =
                        `${result.prediction} (${result.confidence}%)`;
                    predDiv.style.color =
                        result.prediction === "Fake News" ? "#d32f2f" : "#388e3c";
                } else {
                    predDiv.textContent = "Prediction failed";
                    predDiv.style.color = "#f57c00";
                }

            }catch{
                predDiv.textContent = "Server error";
                predDiv.style.color = "#f57c00";
            }
        }

    }catch(err){
        console.error("Live news error:", err);
    }
}

// Initial load + refresh every 5 minutes
fetchLiveNews();
setInterval(fetchLiveNews, 300000);
</script>
</body>
</html>
